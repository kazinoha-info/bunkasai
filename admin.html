<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>æ–‡åŒ–ç¥­ é˜²ç½ãƒ»æ··é›‘ç®¡ç†</title>

<style>

body{
  margin:0;
  font-family:"Segoe UI","Noto Sans JP",sans-serif;
  background:linear-gradient(180deg,#e3f2fd,#ffffff);
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
}

/* å…¨ä½“ã‚«ãƒ¼ãƒ‰ */
#panel{
  background:white;
  width:92%;
  max-width:520px;
  border-radius:22px;
  padding:25px;
  box-shadow:0 6px 20px rgba(0,0,0,0.15);
}

/* ã‚¿ã‚¤ãƒˆãƒ« */
h1{
  text-align:center;
  margin:0 0 20px;
  color:#1565c0;
  font-size:26px;
}

/* ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
.section{
  margin-bottom:25px;
}

.section h2{
  font-size:20px;
  margin-bottom:10px;
  color:#333;
  border-left:6px solid #1565c0;
  padding-left:8px;
}

/* ãƒœã‚¿ãƒ³å…±é€š */
button{
  width:100%;
  font-size:20px;
  font-weight:bold;
  padding:14px;
  margin:6px 0;
  border:none;
  border-radius:14px;
  cursor:pointer;
  transition:0.15s;
}

button:active{
  transform:scale(0.96);
  opacity:0.85;
}

/* é˜²ç½ãƒœã‚¿ãƒ³ */
.btn-drill{ background:#f9a825; color:#333; }
.btn-real{ background:#c62828; color:white; }
.btn-stop{ background:#2e7d32; color:white; }

/* ã‚»ãƒ¬ã‚¯ãƒˆ */
select{
  width:100%;
  font-size:20px;
  padding:10px;
  border-radius:10px;
  border:2px solid #1565c0;
  margin-bottom:10px;
}

/* æ··é›‘ãƒœã‚¿ãƒ³ */
.crowd-btns{
  display:grid;
  grid-template-columns:1fr 1fr 1fr;
  gap:10px;
}

.btn-ok{ background:#2e7d32; color:white; }
.btn-mid{ background:#f9a825; color:#333; }
.btn-ng{ background:#c62828; color:white; }

/* ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ */
#msg{
  margin-top:12px;
  text-align:center;
  font-weight:bold;
  color:#2e7d32;
  min-height:1.4em;
}

.footer{
  margin-top:15px;
  font-size:12px;
  text-align:center;
  color:#777;
}

</style>
</head>

<body>

<div id="panel">

<h1>æ–‡åŒ–ç¥­ é˜²ç½ãƒ»æ··é›‘ç®¡ç†</h1>

<!-- é˜²ç½ -->
<div class="section">

  <h2>ğŸš¨ é˜²ç½ç®¡ç†</h2>

  <button class="btn-drill" onclick="startDrill()">
    âš  è¨“ç·´é–‹å§‹
  </button>

  <button class="btn-real" onclick="startReal()">
    ğŸš¨ æœ¬ç•ªè­¦å ±
  </button>

  <button class="btn-stop" onclick="stopAll()">
    âœ… è§£é™¤
  </button>

</div>

<!-- æ··é›‘ -->
<div class="section">

  <h2>ğŸ‘¥ æ··é›‘æ›´æ–°</h2>

  <select id="cName">
    <option>èª­ã¿è¾¼ã¿ä¸­...</option>
  </select>

  <div class="crowd-btns">

    <button class="btn-ok" onclick="setStatus('â—‹')">
      â—‹ ç©ºã
    </button>

    <button class="btn-mid" onclick="setStatus('â–³')">
      â–³ æ™®é€š
    </button>

    <button class="btn-ng" onclick="setStatus('Ã—')">
      Ã— æ··é›‘
    </button>

  </div>

</div>

<p id="msg"></p>

<div class="footer">
  â€» æ“ä½œå†…å®¹ã¯å³æ™‚åæ˜ ã•ã‚Œã¾ã™
</div>

</div>


<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>

const firebaseConfig = {
  apiKey: "AIzaSyDTHN-YfAJz86NgNAaldixubGfDZwRgnKw",
  authDomain: "bunkasai-info-59212.firebaseapp.com",
  databaseURL: "https://bunkasai-info-59212-default-rtdb.firebaseio.com",
  projectId: "bunkasai-info-59212",
  storageBucket: "bunkasai-info-59212.firebasestorage.app",
  messagingSenderId: "775251011941",
  appId: "1:775251011941:web:7237a990162fa00217198c"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const select = document.getElementById("cName");
const msg = document.getElementById("msg");

/* é˜²ç½ */
function startDrill(){

  db.ref("system").set({
    emergency:true,
    mode:"drill",
    message:"ç·Šæ€¥åœ°éœ‡é€Ÿå ±è¨“ç·´ä¸­ã§ã™ã€‚ã“ã‚Œã¯ãƒ†ã‚¹ãƒˆã§ã™ã€‚è½ã¡ç€ã„ã¦è¡Œå‹•ã—ã¦ãã ã•ã„ã€‚"
  });

  showMsg("è¨“ç·´ãƒ¢ãƒ¼ãƒ‰é–‹å§‹");
}

function startReal(){

  db.ref("system").set({
    emergency:true,
    mode:"real",
    message:"å¼·ã„æºã‚Œã«è­¦æˆ’ã—ã¦ãã ã•ã„ã€‚èº«ã‚’å®ˆã£ã¦ãã ã•ã„ã€‚ä»˜è¿‘ã«å€’ã‚Œã‚„ã™ã„ã‚‚ã®è½ã¡ã¦ãã‚„ã™ã„ã‚‚ã®ãªã©ãŒã‚ã‚‹å ´åˆã¯é€Ÿã‚„ã‹ã«ç§»å‹•ã—ã¦ãã ã•ã„ã€‚åœ°éœ‡ãŒåã¾ã‚Šæ¬¡ç¬¬ã€ä¿‚å§”å“¡ã®æŒ‡ç¤ºã«å¾“ã£ã¦ãã ã•ã„ã€‚"
  });

  showMsg("æœ¬ç•ªè­¦å ± ç™ºä»¤");
}

function stopAll(){

  db.ref("system").set({
    emergency:false,
    mode:"normal"
  });

  showMsg("è­¦å ±è§£é™¤");
}

/* æ··é›‘ */
function setStatus(s){

  const key = select.value;

  if(!key){
    alert("å ´æ‰€ã‚’é¸ã‚“ã§ãã ã•ã„");
    return;
  }

  db.ref("classes/"+key+"/status").set(s);

  showMsg("æ··é›‘çŠ¶æ³ æ›´æ–°å®Œäº†");
}

/* ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º */
function showMsg(t){

  msg.textContent = "âœ” " + t;

  setTimeout(()=>{
    msg.textContent="";
  },1500);
}

/* ã‚¯ãƒ©ã‚¹å–å¾— */
db.ref("classes").on("value", snap=>{

  const data = snap.val();

  select.innerHTML="";

  if(!data) return;

  for(let k in data){

    const opt = document.createElement("option");
    opt.value = k;
    opt.textContent = data[k].name;

    select.appendChild(opt);
  }

});

</script>

</body>
</html>
