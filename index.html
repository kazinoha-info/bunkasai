<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>æ–‡åŒ–ç¥­æ¡ˆå†…</title>
<style>
body{
  margin:0;
  font-family: "Trebuchet", sans-serif;
  background: #eaf3ff;
}

/* ãƒ˜ãƒƒãƒ€ãƒ¼ */
h1{
  background:#ed7d0c;
  color:orange;
  padding:20px;
  margin:0;
  text-align:center;
}

/* ãƒ†ãƒ­ãƒƒãƒ— */
#ticker{
  background:#ed7d0c;
  color:white;
  overflow:hidden;
  white-space:nowrap;
  height:100px;
  line-height:100px;
}

#ticker-text{
  display:inline-block;
  padding-left:100%;
  animation: scroll 60s linear infinite;
  font-size: 32px;       /* â†ã“ã“ã§æ–‡å­—ã®å¤§ãã•ã‚’èª¿æ•´ï¼ˆæ•°å­—ã‚’å¤§ããã™ã‚‹ã¨å­—ã‚‚å¤§ãããªã‚‹ï¼‰ */
  font-weight: bold;     /* â†å¤ªå­—ã«ã™ã‚‹ã¨ã‚ˆã‚Šç›®ç«‹ã¡ã¾ã™ */
}

@keyframes scroll{
  from{ transform: translateX(0); }
  to{ transform: translateX(-100%); }
}

@keyframes stops-scroll {
  0% {
    transform: translateX(100%);
  }

  100% {
    transform: translateX(-100%);
  }
}


/* ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
#layout{
  display:grid;
  grid-template-columns: 3fr 2fr; /* å·¦3ï¼šå³2 */
  height: calc(100vh - 100px);
}

#right h2{
  font-size:28px;
  font-weight:bold;
  color:white;
  background:black;
  padding:8px;
  border-radius:6px;
  text-align:center;
}

/* å·¦ */
#left{
  overflow:auto;
}

#list{
  display:grid;
  grid-template-columns: repeat(auto-fill, minmax(250px,1fr));
  gap:15px;
  padding:20px;
}

/* ã‚«ãƒ¼ãƒ‰ */
.card{
  background:white;
  border-radius:10px;
  padding:15px;
  box-shadow:0 2px 5px rgba(0,0,0,0.1);
  text-align:center;
  font-size:18px;
}

.status{
  font-size:28px;
  font-weight:bold;
  margin-top:10px;
}

.ok{ color:#2e7d32; }
.mid{ color:#f9a825; }
.ng{ color:#c62828; }

/* å³ */
#right{
  background:#f5f9ff;
  padding:15px;
  border-left:2px solid #bbdefb;

  overflow-y:auto;   /* â†è¿½åŠ  */
}


.btns{
  margin:10px 0;
}

.btns button{
  padding:8px 15px;
  margin-right:5px;
  border:none;
  border-radius:5px;
  background:#1565c0;
  color:white;
  cursor:pointer;
  border-radius:6px;
}

.btns button:hover{
  opacity:0.8;
}

/* æ™‚åˆ» */
.time{
  font-size:20px;
  padding:5px;
  border-bottom:1px solid #ddd;
}

.board{
  background:black;
  color:#ccc;
  font-size:26px;
  padding:15px;
  border-radius:10px;
  font-family: monospace;
}

.row{
  display:grid;
  grid-template-columns: 60px 100px 1fr 80px;
  padding:8px 0;
  border-bottom:1px solid #333;
}


/* é¸æŠä¸­ãƒœã‚¿ãƒ³ */
.btns button.active{
  background:#ff9800;
  color:black;
  font-weight:bold;
}

/* ===== é§…è¡¨ç¤ºãƒœãƒ¼ãƒ‰ ===== */

.station-name{
  text-align:center;
  font-size:28px;
  margin-bottom:15px;
  border-bottom:2px solid white;
  padding-bottom:8px;
}

.jr-title{
  font-size:22px;
  margin:15px 0 5px;
}

.jr-row{
  display:flex;
  justify-content:space-between;
  padding:8px 0;
  border-bottom:1px solid white;
  font-size:20px;
}

.jr-dest{
  margin-left:20px;
}

/* JRé¢¨è¡¨ç¤º */

.jr-board{
  background:black;
  color:#0af;
  font-family: monospace;
  padding:15px;
  border-radius:10px;
  margin-bottom:15px;

  width: 100%;        /* â†è¿½åŠ  */
  box-sizing: border-box; /* â†è¿½åŠ  */
}


.jr-row{
  display:flex;
  font-size:22px;
  padding:5px 0;
  border-bottom:1px solid #333;
}

.jr-time{
  width:80px;
  color:#0af;
}

.jr-dest{
  flex:1;
  color:white;
}

.stops{
  margin-top:10px;
  overflow:hidden;
  white-space:nowrap;
  color:white;
  font-weight:bold;
  position: relative;
}

.stops span{
  display:inline-block;
  padding-left:0;   /* â† 0ã«ã™ã‚‹ */
  font-size:28px;
  font-weight:bold;

  white-space: nowrap;
  will-change: transform;
}

/* è¦‹å‡ºã—ç³»ã‚’å¼·èª¿ */

.jr-board h3{
  font-size:30px;
  font-weight:bold;
  color:white;
  margin:5px 0 10px;
}

.jr-board b{
  font-size:24px;
  font-weight:bold;
  color:white;
}

.stops.fixed{
  overflow: visible;
  white-space: normal;
  animation: none;
  font-size:26px;
}

</style>

</head>
<body>

<div id="ticker">
  <div id="ticker-text">
    ç¬¬67å›æ¢¶ã®è‘‰ç¥­ã«ã”æ¥å ´ãã ã•ã„ã¾ã—ã¦ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚è¨˜éŒ²çš„ãªçŒ›æš‘ãŒç¶šã„ã¦ãŠã‚Šã€ç†±ä¸­ç—‡ã®å±é™ºãŒé«˜ã¾ã£ã¦ã„ã¾ã™ã€‚"ã“ã¾ã‚ãªæ°´åˆ†è£œçµ¦"ã‚„"æ—¥é™°ã§ã®ä¼‘æ†©"ãªã©ã€ç†±ä¸­ç—‡å¯¾ç­–ã«ã”å”åŠ›ãŠé¡˜ã„ã—ã¾ã™ã€‚
  </div>
</div>
<div id="layout">

  <!-- å·¦ï¼šã‚¯ãƒ©ã‚¹ -->
  <div id="left">
    <div id="list">èª­ã¿è¾¼ã¿ä¸­...</div>
  </div>

  <!-- å³ï¼šæ™‚åˆ»è¡¨ -->
  <div id="right">
  <h2>ğŸšğŸšƒ äº¤é€šæ¡ˆå†…</h2>
  <div class="btns"></div>
    
  <!-- é›»è»Š -->
  <div id="trainBoard"></div>
  <hr>
    
  <!-- ãƒã‚¹ -->
  <div id="busBoard"></div>

</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
  // ğŸ”½ Firebaseè¨­å®šï¼ˆå›ã®ã‚„ã¤ç”¨ã«ã‚‚ã†å…¥ã‚Œã¦ã‚ã‚‹ï¼‰
  const firebaseConfig = {
  apiKey: "AIzaSyDTHN-YfAJz86NgNAaldixubGfDZwRgnKw",
  authDomain: "bunkasai-info-59212.firebaseapp.com",
  databaseURL: "https://bunkasai-info-59212-default-rtdb.firebaseio.com",
  projectId: "bunkasai-info-59212",
  storageBucket: "bunkasai-info-59212.firebasestorage.app",
  messagingSenderId: "775251011941",
  appId: "1:775251011941:web:7237a990162fa00217198c"
};


  // åˆæœŸåŒ–
  firebase.initializeApp(firebaseConfig);

// DBå‚ç…§
const db = firebase.database();
const ref = db.ref("classes");

// ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å–å¾—ï¼ˆå…¨éƒ¨èª­ã‚€ï¼‰
ref.on("value", (snapshot) => {
  const data = snapshot.val();

  let html = "";

  for (let key in data) {

    let statusClass = "";

    if(data[key].status==="â—‹") statusClass="ok";
    if(data[key].status==="â–³") statusClass="mid";
    if(data[key].status==="Ã—") statusClass="ng";

    html += `
      <div class="card">
        <div>${data[key].name}</div>
        <div class="status ${statusClass}">
          ${data[key].status}
        </div>
      </div>
    `;
  }

  document.getElementById("list").innerHTML = html;
});

// åˆæœŸè¨­å®š
let mode = "weekday"; // weekday / holiday

function setMode(m){

  mode = m;

  // ãƒœã‚¿ãƒ³ã®è¦‹ãŸç›®åˆ‡ã‚Šæ›¿ãˆ
  document.querySelectorAll(".btns button").forEach(btn=>{
    btn.classList.remove("active");
  });

  if(m==="weekday"){
    document.getElementById("btnWeek").classList.add("active");
  }else{
    document.getElementById("btnHoliday").classList.add("active");
  }

  loadTransport();
}


// ãƒœã‚¿ãƒ³è¿½åŠ 
document.querySelector(".btns").innerHTML = `
  <button id="btnWeek" onclick="setMode('weekday')" class="active">å¹³æ—¥</button>
  <button id="btnHoliday" onclick="setMode('holiday')">ä¼‘æ—¥</button>
`;

// èª­ã¿è¾¼ã¿
function loadTransport(){

  firebase.database().ref("transport").once("value", snap=>{

    const data = snap.val();

    let trainHTML = "";
    let busHTML = "";

    /* ğŸšƒ é›»è»Š */
    if(data.train){

      for(let k in data.train){

  const st = data.train[k];
  const d = st[mode] || { up: [], down: [] };

  // ğŸ”½ é»’èƒŒæ™¯ã‚¹ã‚¿ãƒ¼ãƒˆ
  trainHTML += `<div class="jr-board">`;

  trainHTML += `<h3>ğŸš‰ ${st.name}</h3>`;

        /* ä¸‹ã‚Šï¼ˆå…ˆã«è¡¨ç¤ºï¼‰ */
trainHTML += `
  <div><b>â¬‡ ä¸‹ã‚Š</b></div>
`;

d.down.slice(0,3).forEach(t=>{
  trainHTML += `
    <div class="jr-row">
      <div class="jr-time">${t.time}</div>
      <div class="jr-dest">${t.dest}</div>
    </div>
  `;
});

if(st.downStops && st.downStops.length){

  trainHTML += `
    <div class="stops">
      <span>åœè»Šé§… â–¶ ${st.downStops.join(" â†’ ")}</span>
    </div>
  `;
}


/* ä¸Šã‚Šï¼ˆã‚ã¨ï¼‰ */
trainHTML += `<br><b>â¬† ä¸Šã‚Š</b><br>`;

d.up.slice(0,3).forEach(t=>{
  trainHTML += `
    <div class="jr-row">
      <div class="jr-time">${t.time}</div>
      <div class="jr-dest">${t.dest}</div>
    </div>
  `;
});

/* ä¸Šã‚Šã¯å›ºå®šè¡¨ç¤ºï¼ˆæµã•ãªã„ï¼‰ */
if(st.upStops && st.upStops.length){

  trainHTML += `
    <div class="stops fixed">
      åœè»Šé§… â–¶ ${st.upStops.join(" â†’ ")}
    </div>
  `;
}

        trainHTML += `</div>`;
      }
    }


    /* ğŸšŒ ãƒã‚¹ */
    if(data.bus){

      for(let k in data.bus){

        const stop = data.bus[k];
        const d = stop[mode] || { toStation: [], toTown: [] };

        busHTML += `
          <div class="jr-board">

            <h3>ğŸšŒ ${stop.name}</h3>

            <b>â–¶ é§…æ–¹é¢</b><br>
            ${d.toStation.map(t=>`
              <div class="jr-row">
                <div class="jr-time">${t}</div>
                <div class="jr-dest">é§…è¡Œã</div>
              </div>
            `).join("")}

            <br><b>â–¶ ç”ºæ–¹é¢</b><br>
            ${d.toTown.map(t=>`
              <div class="jr-row">
                <div class="jr-time">${t}</div>
                <div class="jr-dest">ç”ºè¡Œã</div>
              </div>
            `).join("")}

          </div>
        `;
      }
    }

    document.getElementById("trainBoard").innerHTML = trainHTML;
    document.getElementById("busBoard").innerHTML = busHTML;
    
    setupStopScroll();

  });

}

// åœè»Šé§…ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é€Ÿåº¦ã‚’çµ±ä¸€
// åœè»Šé§…ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é€Ÿåº¦ã‚’çµ±ä¸€ï¼‹å¾…ã¡æ™‚é–“ä»˜ã
function setupStopScroll(){

  document.querySelectorAll(".stops span").forEach(span=>{

    const parent = span.parentElement;

    const textWidth = span.scrollWidth;
    const boxWidth = parent.clientWidth;

    const distance = textWidth + boxWidth;

    const speed = 50; // â† å°ã•ãã™ã‚‹ã¨é…ããªã‚‹ï¼ˆä»Š80â†’50ã«ï¼‰

    const duration = distance / speed;

    const wait = 5; // â† æ¶ˆãˆã¦ã‹ã‚‰5ç§’å¾…ã¤

    span.style.animation = `
      stops-scroll ${duration}s linear ${wait}s infinite
    `;
  });

}

loadTransport();

setInterval(loadTransport, 30000); // 30ç§’ã”ã¨æ›´æ–°

</script>

</body>
</html>












